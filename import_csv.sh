#!/bin/bash

# Prompt for database connection settings
read -p "Enter MariaDB User: " USER
read -sp "Enter MariaDB Password: " PASSWORD
echo # Move to a new line

# Set fixed values for database and table names
DATABASE="mariadb"
TABLE="drive_stats"

# Directory where CSV files are stored
DIRECTORY="/var/tmp/mariadb"

# Check if the directory contains any CSV files
if [ $(ls $DIRECTORY/*.csv 2> /dev/null | wc -l) -eq 0 ]; then
  echo "No CSV files found in $DIRECTORY."
  exit 1
fi

# Log file
LOGFILE="/var/tmp/mariadb_import.log"

# Disable foreign key checks for performance
mysql -u $USER -p$PASSWORD $DATABASE -e "SET foreign_key_checks = 0;"

# Loop through CSV files in the directory
for FILE in $DIRECTORY/*.csv; do
  # Display start time of the import for each file
  echo "Starting import for $FILE at $(date)" | tee -a $LOGFILE

  # Import CSV file into the table, converting empty fields to NULL for all SMART attributes
  mysql -u $USER -p$PASSWORD $DATABASE -e "LOAD DATA LOCAL INFILE '"$FILE"' INTO TABLE $TABLE FIELDS TERMINATED BY ',' LINES TERMINATED BY '\n' (id, date, serial_number, vendor, model, model_backblaze, source_file, modified, capacity_bytes, failure, datacenter, cluster_id, vault_id, pod_id, pod_slot_num, is_legacy_format, @smart_1_normalized, @smart_1_raw, @smart_2_normalized, @smart_2_raw, @smart_3_normalized, @smart_3_raw, @smart_4_normalized, @smart_4_raw, @smart_5_normalized, @smart_5_raw, @smart_7_normalized, @smart_7_raw, @smart_8_normalized, @smart_8_raw, @smart_9_normalized, @smart_9_raw, @smart_10_normalized, @smart_10_raw, @smart_11_normalized, @smart_11_raw, @smart_12_normalized, @smart_12_raw, @smart_13_normalized, @smart_13_raw, @smart_15_normalized, @smart_15_raw, @smart_16_normalized, @smart_16_raw, @smart_17_normalized, @smart_17_raw, @smart_18_normalized, @smart_18_raw, @smart_22_normalized, @smart_22_raw, @smart_23_normalized, @smart_23_raw, @smart_24_normalized, @smart_24_raw, @smart_27_normalized, @smart_27_raw, @smart_71_normalized, @smart_71_raw, @smart_82_normalized, @smart_82_raw, @smart_90_normalized, @smart_90_raw, @smart_160_normalized, @smart_160_raw, @smart_161_normalized, @smart_161_raw, @smart_163_normalized, @smart_163_raw, @smart_164_normalized, @smart_164_raw, @smart_165_normalized, @smart_165_raw, @smart_166_normalized, @smart_166_raw, @smart_167_normalized, @smart_167_raw, @smart_168_normalized, @smart_168_raw, @smart_169_normalized, @smart_169_raw, @smart_170_normalized, @smart_170_raw, @smart_171_normalized, @smart_171_raw, @smart_172_normalized, @smart_172_raw, @smart_173_normalized, @smart_173_raw, @smart_174_normalized, @smart_174_raw, @smart_175_normalized, @smart_175_raw, @smart_176_normalized, @smart_176_raw, @smart_177_normalized, @smart_177_raw, @smart_178_normalized, @smart_178_raw, @smart_179_normalized, @smart_179_raw, @smart_180_normalized, @smart_180_raw, @smart_181_normalized, @smart_181_raw, @smart_182_normalized, @smart_182_raw, @smart_183_normalized, @smart_183_raw, @smart_184_normalized, @smart_184_raw, @smart_187_normalized, @smart_187_raw, @smart_188_normalized, @smart_188_raw, @smart_189_normalized, @smart_189_raw, @smart_190_normalized, @smart_190_raw, @smart_191_normalized, @smart_191_raw, @smart_192_normalized, @smart_192_raw, @smart_193_normalized, @smart_193_raw, @smart_194_normalized, @smart_194_raw, @smart_195_normalized, @smart_195_raw, @smart_196_normalized, @smart_196_raw, @smart_197_normalized, @smart_197_raw, @smart_198_normalized, @smart_198_raw, @smart_199_normalized, @smart_199_raw, @smart_200_normalized, @smart_200_raw, @smart_201_normalized, @smart_201_raw, @smart_202_normalized, @smart_202_raw, @smart_206_normalized, @smart_206_raw, @smart_210_normalized, @smart_210_raw, @smart_218_normalized, @smart_218_raw, @smart_220_normalized, @smart_220_raw, @smart_222_normalized, @smart_222_raw, @smart_223_normalized, @smart_223_raw, @smart_224_normalized, @smart_224_raw, @smart_225_normalized, @smart_225_raw, @smart_226_normalized, @smart_226_raw, @smart_230_normalized, @smart_230_raw, @smart_231_normalized, @smart_231_raw, @smart_232_normalized, @smart_232_raw, @smart_233_normalized, @smart_233_raw, @smart_234_normalized, @smart_234_raw, @smart_235_normalized, @smart_235_raw, @smart_240_normalized, @smart_240_raw, @smart_241_normalized, @smart_241_raw, @smart_242_normalized, @smart_242_raw, @smart_244_normalized, @smart_244_raw, @smart_245_normalized, @smart_245_raw, @smart_246_normalized, @smart_246_raw, @smart_247_normalized, @smart_247_raw, @smart_248_normalized, @smart_248_raw, @smart_250_normalized, @smart_250_raw, @smart_251_normalized, @smart_251_raw, @smart_252_normalized, @smart_252_raw, @smart_254_normalized, @smart_254_raw, @smart_255_normalized, @smart_255_raw) SET smart_1_normalized = NULLIF(@smart_1_normalized, ''), smart_1_raw = NULLIF(@smart_1_raw, ''), smart_2_normalized = NULLIF(@smart_2_normalized, ''), smart_2_raw = NULLIF(@smart_2_raw, ''), smart_3_normalized = NULLIF(@smart_3_normalized, ''), smart_3_raw = NULLIF(@smart_3_raw, ''), smart_4_normalized = NULLIF(@smart_4_normalized, ''), smart_4_raw = NULLIF(@smart_4_raw, ''), smart_5_normalized = NULLIF(@smart_5_normalized, ''), smart_5_raw = NULLIF(@smart_5_raw, ''), smart_7_normalized = NULLIF(@smart_7_normalized, ''), smart_7_raw = NULLIF(@smart_7_raw, ''), smart_8_normalized = NULLIF(@smart_8_normalized, ''), smart_8_raw = NULLIF(@smart_8_raw, ''), smart_9_normalized = NULLIF(@smart_9_normalized, ''), smart_9_raw = NULLIF(@smart_9_raw, ''), smart_10_normalized = NULLIF(@smart_10_normalized, ''), smart_10_raw = NULLIF(@smart_10_raw, ''), smart_11_normalized = NULLIF(@smart_11_normalized, ''), smart_11_raw = NULLIF(@smart_11_raw, ''), smart_12_normalized = NULLIF(@smart_12_normalized, ''), smart_12_raw = NULLIF(@smart_12_raw, ''), smart_13_normalized = NULLIF(@smart_13_normalized, ''), smart_13_raw = NULLIF(@smart_13_raw, ''), smart_15_normalized = NULLIF(@smart_15_normalized, ''), smart_15_raw = NULLIF(@smart_15_raw, ''), smart_16_normalized = NULLIF(@smart_16_normalized, ''), smart_16_raw = NULLIF(@smart_16_raw, ''), smart_17_normalized = NULLIF(@smart_17_normalized, ''), smart_17_raw = NULLIF(@smart_17_raw, ''), smart_18_normalized = NULLIF(@smart_18_normalized, ''), smart_18_raw = NULLIF(@smart_18_raw, ''), smart_22_normalized = NULLIF(@smart_22_normalized, ''), smart_22_raw = NULLIF(@smart_22_raw, ''), smart_23_normalized = NULLIF(@smart_23_normalized, ''), smart_23_raw = NULLIF(@smart_23_raw, ''), smart_24_normalized = NULLIF(@smart_24_normalized, ''), smart_24_raw = NULLIF(@smart_24_raw, ''), smart_27_normalized = NULLIF(@smart_27_normalized, ''), smart_27_raw = NULLIF(@smart_27_raw, ''), smart_71_normalized = NULLIF(@smart_71_normalized, ''), smart_71_raw = NULLIF(@smart_71_raw, ''), smart_82_normalized = NULLIF(@smart_82_normalized, ''), smart_82_raw = NULLIF(@smart_82_raw, ''), smart_90_normalized = NULLIF(@smart_90_normalized, ''), smart_90_raw = NULLIF(@smart_90_raw, ''), smart_160_normalized = NULLIF(@smart_160_normalized, ''), smart_160_raw = NULLIF(@smart_160_raw, ''), smart_161_normalized = NULLIF(@smart_161_normalized, ''), smart_161_raw = NULLIF(@smart_161_raw, ''), smart_163_normalized = NULLIF(@smart_163_normalized, ''), smart_163_raw = NULLIF(@smart_163_raw, ''), smart_164_normalized = NULLIF(@smart_164_normalized, ''), smart_164_raw = NULLIF(@smart_164_raw, ''), smart_165_normalized = NULLIF(@smart_165_normalized, ''), smart_165_raw = NULLIF(@smart_165_raw, ''), smart_166_normalized = NULLIF(@smart_166_normalized, ''), smart_166_raw = NULLIF(@smart_166_raw, ''), smart_167_normalized = NULLIF(@smart_167_normalized, ''), smart_167_raw = NULLIF(@smart_167_raw, ''), smart_168_normalized = NULLIF(@smart_168_normalized, ''), smart_168_raw = NULLIF(@smart_168_raw, ''), smart_169_normalized = NULLIF(@smart_169_normalized, ''), smart_169_raw = NULLIF(@smart_169_raw, ''), smart_170_normalized = NULLIF(@smart_170_normalized, ''), smart_170_raw = NULLIF(@smart_170_raw, ''), smart_171_normalized = NULLIF(@smart_171_normalized, ''), smart_171_raw = NULLIF(@smart_171_raw, ''), smart_172_normalized = NULLIF(@smart_172_normalized, ''), smart_172_raw = NULLIF(@smart_172_raw, ''), smart_173_normalized = NULLIF(@smart_173_normalized, ''), smart_173_raw = NULLIF(@smart_173_raw, ''), smart_174_normalized = NULLIF(@smart_174_normalized, ''), smart_174_raw = NULLIF(@smart_174_raw, ''), smart_175_normalized = NULLIF(@smart_175_normalized, ''), smart_175_raw = NULLIF(@smart_175_raw, ''), smart_176_normalized = NULLIF(@smart_176_normalized, ''), smart_176_raw = NULLIF(@smart_176_raw, ''), smart_177_normalized = NULLIF(@smart_177_normalized, ''), smart_177_raw = NULLIF(@smart_177_raw, ''), smart_178_normalized = NULLIF(@smart_178_normalized, ''), smart_178_raw = NULLIF(@smart_178_raw, ''), smart_179_normalized = NULLIF(@smart_179_normalized, ''), smart_179_raw = NULLIF(@smart_179_raw, ''), smart_180_normalized = NULLIF(@smart_180_normalized, ''), smart_180_raw = NULLIF(@smart_180_raw, ''), smart_181_normalized = NULLIF(@smart_181_normalized, ''), smart_181_raw = NULLIF(@smart_181_raw, ''), smart_182_normalized = NULLIF(@smart_182_normalized, ''), smart_182_raw = NULLIF(@smart_182_raw, ''), smart_183_normalized = NULLIF(@smart_183_normalized, ''), smart_183_raw = NULLIF(@smart_183_raw, ''), smart_184_normalized = NULLIF(@smart_184_normalized, ''), smart_184_raw = NULLIF(@smart_184_raw, ''), smart_187_normalized = NULLIF(@smart_187_normalized, ''), smart_187_raw = NULLIF(@smart_187_raw, ''), smart_188_normalized = NULLIF(@smart_188_normalized, ''), smart_188_raw = NULLIF(@smart_188_raw, ''), smart_189_normalized = NULLIF(@smart_189_normalized, ''), smart_189_raw = NULLIF(@smart_189_raw, ''), smart_190_normalized = NULLIF(@smart_190_normalized, ''), smart_190_raw = NULLIF(@smart_190_raw, ''), smart_191_normalized = NULLIF(@smart_191_normalized, ''), smart_191_raw = NULLIF(@smart_191_raw, ''), smart_192_normalized = NULLIF(@smart_192_normalized, ''), smart_192_raw = NULLIF(@smart_192_raw, ''), smart_193_normalized = NULLIF(@smart_193_normalized, ''), smart_193_raw = NULLIF(@smart_193_raw, ''), smart_194_normalized = NULLIF(@smart_194_normalized, ''), smart_194_raw = NULLIF(@smart_194_raw, ''), smart_195_normalized = NULLIF(@smart_195_normalized, ''), smart_195_raw = NULLIF(@smart_195_raw, ''), smart_196_normalized = NULLIF(@smart_196_normalized, ''), smart_196_raw = NULLIF(@smart_196_raw, ''), smart_197_normalized = NULLIF(@smart_197_normalized, ''), smart_197_raw = NULLIF(@smart_197_raw, ''), smart_198_normalized = NULLIF(@smart_198_normalized, ''), smart_198_raw = NULLIF(@smart_198_raw, ''), smart_199_normalized = NULLIF(@smart_199_normalized, ''), smart_199_raw = NULLIF(@smart_199_raw, ''), smart_200_normalized = NULLIF(@smart_200_normalized, ''), smart_200_raw = NULLIF(@smart_200_raw, ''), smart_201_normalized = NULLIF(@smart_201_normalized, ''), smart_201_raw = NULLIF(@smart_201_raw, ''), smart_202_normalized = NULLIF(@smart_202_normalized, ''), smart_202_raw = NULLIF(@smart_202_raw, ''), smart_206_normalized = NULLIF(@smart_206_normalized, ''), smart_206_raw = NULLIF(@smart_206_raw, ''), smart_210_normalized = NULLIF(@smart_210_normalized, ''), smart_210_raw = NULLIF(@smart_210_raw, ''), smart_218_normalized = NULLIF(@smart_218_normalized, ''), smart_218_raw = NULLIF(@smart_218_raw, ''), smart_220_normalized = NULLIF(@smart_220_normalized, ''), smart_220_raw = NULLIF(@smart_220_raw, ''), smart_222_normalized = NULLIF(@smart_222_normalized, ''), smart_222_raw = NULLIF(@smart_222_raw, ''), smart_223_normalized = NULLIF(@smart_223_normalized, ''), smart_223_raw = NULLIF(@smart_223_raw, ''), smart_224_normalized = NULLIF(@smart_224_normalized, ''), smart_224_raw = NULLIF(@smart_224_raw, ''), smart_225_normalized = NULLIF(@smart_225_normalized, ''), smart_225_raw = NULLIF(@smart_225_raw, ''), smart_226_normalized = NULLIF(@smart_226_normalized, ''), smart_226_raw = NULLIF(@smart_226_raw, ''), smart_230_normalized = NULLIF(@smart_230_normalized, ''), smart_230_raw = NULLIF(@smart_230_raw, ''), smart_231_normalized = NULLIF(@smart_231_normalized, ''), smart_231_raw = NULLIF(@smart_231_raw, ''), smart_232_normalized = NULLIF(@smart_232_normalized, ''), smart_232_raw = NULLIF(@smart_232_raw, ''), smart_233_normalized = NULLIF(@smart_233_normalized, ''), smart_233_raw = NULLIF(@smart_233_raw, ''), smart_234_normalized = NULLIF(@smart_234_normalized, ''), smart_234_raw = NULLIF(@smart_234_raw, ''), smart_235_normalized = NULLIF(@smart_235_normalized, ''), smart_235_raw = NULLIF(@smart_235_raw, ''), smart_240_normalized = NULLIF(@smart_240_normalized, ''), smart_240_raw = NULLIF(@smart_240_raw, ''), smart_241_normalized = NULLIF(@smart_241_normalized, ''), smart_241_raw = NULLIF(@smart_241_raw, ''), smart_242_normalized = NULLIF(@smart_242_normalized, ''), smart_242_raw = NULLIF(@smart_242_raw, ''), smart_244_normalized = NULLIF(@smart_244_normalized, ''), smart_244_raw = NULLIF(@smart_244_raw, ''), smart_245_normalized = NULLIF(@smart_245_normalized, ''), smart_245_raw = NULLIF(@smart_245_raw, ''), smart_246_normalized = NULLIF(@smart_246_normalized, ''), smart_246_raw = NULLIF(@smart_246_raw, ''), smart_247_normalized = NULLIF(@smart_247_normalized, ''), smart_247_raw = NULLIF(@smart_247_raw, ''), smart_248_normalized = NULLIF(@smart_248_normalized, ''), smart_248_raw = NULLIF(@smart_248_raw, ''), smart_250_normalized = NULLIF(@smart_250_normalized, ''), smart_250_raw = NULLIF(@smart_250_raw, ''), smart_251_normalized = NULLIF(@smart_251_normalized, ''), smart_251_raw = NULLIF(@smart_251_raw, ''), smart_252_normalized = NULLIF(@smart_252_normalized, ''), smart_252_raw = NULLIF(@smart_252_raw, ''), smart_254_normalized = NULLIF(@smart_254_normalized, ''), smart_254_raw = NULLIF(@smart_254_raw, ''), smart_255_normalized = NULLIF(@smart_255_normalized, ''), smart_255_raw = NULLIF(@smart_255_raw, '');"

  # Display end time of the import for each file
  echo "Finished import for $FILE at $(date)" | tee -a $LOGFILE
done

# Re-enable foreign key checks
mysql -u $USER -p$PASSWORD $DATABASE -e "SET foreign_key_checks = 1;"

echo "All files have been imported." | tee -a $LOGFILE
